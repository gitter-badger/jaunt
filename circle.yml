machine:
  java:
    version: oraclejdk8
  environment:
    _JAVA_OPTIONS: -Xmx2g

dependencies:
  cache_directories:
    - ~/bin
  pre:
    - bash make-astyle.sh
    - bash circle-deps.sh
  post:
    - mvn dependency:resolve-plugins

test:
  pre:
    - bash check-whitespace.sh
    - lein cljfmt check
  override:
    - mvn integration-test

deployment:
  staging:
    branch: /develop/
    commands:
      - mvn versions:set -DgenerateBackupPoms=false -DnewVersion=$(cat VERSION)-SNAPSHOT
      - mvn -s settings.xml deploy
  release:
    tag: /v[0-9]+(\.[0-9]+)*/
    commands:
      - mvn versions:set -DgenerateBackupPoms=false -DnewVersion=$(cat VERSION)
      - mvn -s settings.xml deploy
